# PoC1 æŠ€æœ¯æ¶æ„è®¾è®¡

## ğŸ¯ è®¾è®¡åŸåˆ™

1. **æç®€ä¸»ä¹‰** - æ¯ä¸ªç»„ä»¶éƒ½æ˜¯å¿…éœ€çš„ï¼Œæ²¡æœ‰å†—ä½™
2. **å•ä½“ä¼˜å…ˆ** - é¿å…åˆ†å¸ƒå¼å¤æ‚æ€§
3. **æ‰¹å¤„ç†æ€ç»´** - ç¦»çº¿å¤„ç†ï¼Œåœ¨çº¿æŸ¥è¯¢
4. **æ¸è¿›å¢å¼º** - å¯ä»¥è½»æ¾å‡çº§ä½†ä¸è¿‡åº¦è®¾è®¡

## ğŸ— ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç•Œé¢å±‚                        â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Web UI      â”‚        â”‚  CLI Tool            â”‚   â”‚
â”‚  â”‚  (Streamlit) â”‚        â”‚  (æ‰¹é‡å¯¼å…¥/å¯¼å‡º)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                           â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APIæœåŠ¡å±‚                          â”‚
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚           FastAPI Application               â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ æœç´¢API â”‚  â”‚ æµè§ˆAPI  â”‚  â”‚ æ‰¹å¤„ç†API â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å¤„ç†å¼•æ“å±‚                          â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å›¾åƒè¯†åˆ«å¼•æ“ â”‚  â”‚  OCRå¼•æ“     â”‚  â”‚ æ‰¹å¤„ç†å™¨   â”‚  â”‚
â”‚  â”‚ (RTMDet/CLIP)â”‚  â”‚ (PaddleOCR)  â”‚  â”‚            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ•°æ®å­˜å‚¨å±‚                          â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              SQLiteæ•°æ®åº“                     â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚
â”‚  â”‚  â”‚ å›¾ç‰‡å…ƒæ•°æ®â”‚  â”‚ è¯†åˆ«ç»“æœ â”‚  â”‚  OCRæ–‡æœ¬  â”‚  â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ                     â”‚    â”‚
â”‚  â”‚    åŸå§‹å›¾ç‰‡ / ç¼©ç•¥å›¾ / å¤„ç†ç¼“å­˜              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æŠ€æœ¯æ ˆé€‰æ‹©

### æ ¸å¿ƒä¾èµ–ï¼ˆå¿…éœ€ï¼‰
```python
# requirements.txt - 2024å¹´11æœˆæœ€æ–°ç¨³å®šç‰ˆæœ¬
fastapi==0.121.1           # APIæ¡†æ¶ (æœ€æ–°ç‰ˆæœ¬)
uvicorn==0.38.0            # ASGIæœåŠ¡å™¨ (æœ€æ–°ç‰ˆæœ¬)
streamlit==1.51.0          # å¿«é€ŸWeb UI
sqlalchemy==2.0.44         # ORM
sqlite3                    # å†…ç½®æ•°æ®åº“
pillow==12.0.0             # å›¾åƒå¤„ç†
python-multipart==0.0.20   # æ–‡ä»¶ä¸Šä¼ æ”¯æŒ
aiofiles==25.1.0           # å¼‚æ­¥æ–‡ä»¶æ“ä½œ
pydantic==2.12.4           # æ•°æ®éªŒè¯
```

### è¯†åˆ«å¼•æ“
```python
# ä¸»æ–¹æ¡ˆï¼šRTMDet (æ¨èä½¿ç”¨)
torch==2.9.0              # PyTorch (æœ€æ–°ç‰ˆæœ¬)
torchvision==0.24.0       # TorchVision (æœ€æ–°ç‰ˆæœ¬)
mmdet==3.3.0              # MMDetectionæ¡†æ¶
mmengine==0.10.7          # MMEngineåŸºç¡€åº“
mmcv==2.2.0               # MMCVåŸºç¡€åº“

# å¤‡é€‰æ–¹æ¡ˆï¼šCLIP (æ›´è½»é‡ï¼Œå¯é€‰å®‰è£…)
# transformers==4.57.1    # Hugging Face
# clip-interrogator==0.6.0  # CLIPå·¥å…·
```

### OCRå¼•æ“
```python
paddlepaddle==3.2.0       # PaddlePaddleæ¡†æ¶æœ€æ–°ç¨³å®šç‰ˆ
paddleocr==3.3.1          # PaddleOCRæœ€æ–°ç¨³å®šç‰ˆ
```

## ğŸ—„ æ•°æ®åº“è®¾è®¡

### ç®€åŒ–çš„è¡¨ç»“æ„
```sql
-- å›¾ç‰‡ä¸»è¡¨
CREATE TABLE images (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    filename TEXT NOT NULL,
    filepath TEXT NOT NULL,
    file_size INTEGER,
    import_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    process_status TEXT DEFAULT 'pending',  -- pending/processing/completed/failed
    process_time FLOAT,
    thumbnail_path TEXT
);

-- æ£€æµ‹ç»“æœè¡¨
CREATE TABLE detections (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    image_id INTEGER NOT NULL,
    object_class TEXT NOT NULL,      -- æ£€æµ‹åˆ°çš„ç‰©ä½“ç±»åˆ«
    confidence FLOAT NOT NULL,
    bbox_x1 FLOAT,
    bbox_y1 FLOAT,
    bbox_x2 FLOAT,
    bbox_y2 FLOAT,
    FOREIGN KEY (image_id) REFERENCES images(id)
);

-- OCRç»“æœè¡¨
CREATE TABLE ocr_results (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    image_id INTEGER NOT NULL,
    text_content TEXT,
    confidence FLOAT,
    language TEXT,
    FOREIGN KEY (image_id) REFERENCES images(id)
);

-- æœç´¢ç´¢å¼•è¡¨ï¼ˆç®€å•å…¨æ–‡æœç´¢ï¼‰
CREATE VIRTUAL TABLE search_index USING fts5(
    image_id,
    content  -- åˆå¹¶çš„å¯æœç´¢æ–‡æœ¬
);
```

## ğŸ”„ å¤„ç†æµç¨‹

### æ‰¹å¤„ç†æµç¨‹
```python
async def batch_process_images(folder_path: str):
    """
    ç¦»çº¿æ‰¹å¤„ç†ä¸»æµç¨‹
    """
    # 1. æ‰«æå’Œå¯¼å…¥
    images = scan_folder(folder_path)
    for image_path in images:
        db.add_image(image_path, status='pending')
    
    # 2. æ‰¹é‡å¤„ç†ï¼ˆå¯å¹¶è¡Œï¼‰
    batch_size = 10
    for batch in chunks(images, batch_size):
        # 2.1 ç”Ÿæˆç¼©ç•¥å›¾
        create_thumbnails(batch)
        
        # 2.2 ç‰©ä½“æ£€æµ‹
        detections = detect_objects(batch)
        db.save_detections(detections)
        
        # 2.3 OCRæå–ï¼ˆå¦‚æœéœ€è¦ï¼‰
        if has_text_content(batch):
            ocr_results = extract_text(batch)
            db.save_ocr_results(ocr_results)
        
        # 2.4 æ›´æ–°æœç´¢ç´¢å¼•
        update_search_index(batch)
        
        # 2.5 æ ‡è®°å®Œæˆ
        db.update_status(batch, 'completed')
```

### æœç´¢æµç¨‹
```python
def search_images(query: str, filters: dict = None):
    """
    å¿«é€Ÿæ£€ç´¢æµç¨‹
    """
    # 1. å…¨æ–‡æœç´¢
    text_matches = db.search_fulltext(query)
    
    # 2. ç±»åˆ«è¿‡æ»¤ï¼ˆå¦‚æœæŒ‡å®šï¼‰
    if filters.get('category'):
        text_matches = filter_by_category(text_matches, filters['category'])
    
    # 3. ç½®ä¿¡åº¦è¿‡æ»¤
    if filters.get('min_confidence'):
        text_matches = filter_by_confidence(text_matches, filters['min_confidence'])
    
    # 4. è¿”å›ç»“æœ
    return {
        'results': text_matches,
        'total': len(text_matches),
        'query_time': measure_time()
    }
```

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆ

### å¼€å‘ç¯å¢ƒ
```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. åˆå§‹åŒ–æ•°æ®åº“
python scripts/init_db.py

# 3. å¯åŠ¨APIæœåŠ¡
uvicorn app.main:app --reload

# 4. å¯åŠ¨Web UI
streamlit run ui/app.py
```

### ç›®å½•ç»“æ„
```
poc1/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # FastAPIä¸»åº”ç”¨
â”‚   â”œâ”€â”€ models.py            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ database.py          # æ•°æ®åº“è¿æ¥
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ search.py        # æœç´¢API
â”‚       â”œâ”€â”€ batch.py         # æ‰¹å¤„ç†API
â”‚       â””â”€â”€ browse.py        # æµè§ˆAPI
â”œâ”€â”€ processors/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ detector.py          # ç‰©ä½“æ£€æµ‹
â”‚   â”œâ”€â”€ ocr.py              # OCRå¤„ç†
â”‚   â””â”€â”€ batch.py            # æ‰¹å¤„ç†å™¨
â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ app.py              # Streamlitåº”ç”¨
â”‚   â””â”€â”€ components/         # UIç»„ä»¶
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ init_db.py          # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â””â”€â”€ import_batch.py     # æ‰¹é‡å¯¼å…¥è„šæœ¬
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test_*.py           # æµ‹è¯•æ–‡ä»¶
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ images/             # åŸå§‹å›¾ç‰‡
â”‚   â”œâ”€â”€ thumbnails/         # ç¼©ç•¥å›¾
â”‚   â””â”€â”€ cache/             # å¤„ç†ç¼“å­˜
â”œâ”€â”€ requirements.txt
â””â”€â”€ README.md
```

## ğŸ¯ æ€§èƒ½ç›®æ ‡ï¼ˆéå¼ºåˆ¶ï¼‰

- **æ‰¹å¤„ç†é€Ÿåº¦**: 10-20å¼ /åˆ†é’Ÿï¼ˆCPUï¼‰
- **æœç´¢å“åº”**: < 1ç§’ï¼ˆ1ä¸‡å¼ å›¾ç‰‡ï¼‰
- **å†…å­˜å ç”¨**: < 2GB
- **å­˜å‚¨å ç”¨**: åŸå›¾ + 20%ï¼ˆç¼©ç•¥å›¾å’Œå…ƒæ•°æ®ï¼‰

## âš™ï¸ é…ç½®ç¤ºä¾‹

```python
# config.py
class Settings:
    # æ•°æ®åº“
    DATABASE_URL = "sqlite:///./poc1.db"
    
    # æ‰¹å¤„ç†
    BATCH_SIZE = 100  # é€‚é…å¤§æ–‡ä»¶ï¼Œæ¯æ‰¹100å¼ 
    MAX_WORKERS = 8   # å……åˆ†åˆ©ç”¨å¤šæ ¸CPU
    CHECKPOINT_INTERVAL = 500  # æ¯500å¼ ä¿å­˜è¿›åº¦
    
    # å›¾åƒå¤„ç†
    THUMBNAIL_SIZE = (512, 512)  # å¢åŠ ç¼©ç•¥å›¾è´¨é‡
    THUMBNAIL_QUALITY = 85  # å‹ç¼©è´¨é‡
    MAX_IMAGE_SIZE = 60 * 1024 * 1024  # 60MBä¸Šé™
    SUPPORTED_FORMATS = ['.jpg', '.jpeg', '.png', '.webp', '.heic']
    USE_WEBP = True  # ç¼©ç•¥å›¾ä½¿ç”¨WebPæ ¼å¼èŠ‚çœç©ºé—´
    
    # æ£€æµ‹å¼•æ“
    DETECTION_MODEL = "rtmdet-l"  # RTMDet-L (52.8% mAP, Apache-2.0è®¸å¯)
    # DETECTION_MODEL = "clip-base"  # å¤‡é€‰æ–¹æ¡ˆ
    CONFIDENCE_THRESHOLD = 0.3
    
    # OCR
    OCR_LANGS = ['ch', 'en']
    
    # æœç´¢
    SEARCH_LIMIT = 50
    
    # å­˜å‚¨è·¯å¾„
    UPLOAD_PATH = "data/images"
    THUMBNAIL_PATH = "data/thumbnails"
    CACHE_PATH = "data/cache"
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ä¸è¿½æ±‚å®æ—¶æ€§** - æ‰¹å¤„ç†ä¼˜å…ˆï¼Œç”¨æˆ·å¯ä»¥ç­‰å¾…
2. **ä¸è¿‡åº¦ä¼˜åŒ–** - ä»£ç æ¸…æ™°æ¯”æ€§èƒ½é‡è¦
3. **ä¸å¤„ç†è¾¹ç¼˜æƒ…å†µ** - ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½
4. **ä¸è€ƒè™‘æ‰©å±•æ€§** - å•æœºå•ç”¨æˆ·å³å¯
5. **ä¿æŒç®€å•** - å¦‚æœä¸€ä¸ªåŠŸèƒ½éœ€è¦å¤æ‚å®ç°ï¼Œè€ƒè™‘ç æ‰

## ä¸‹ä¸€æ­¥

â†’ æŸ¥çœ‹[å®æ–½è®¡åˆ’](implementation.md)äº†è§£å…·ä½“å¼€å‘æ­¥éª¤
