# Phase 1 configuration file
# Provides dataset and processing parameters for local experiments

# Dataset configuration
dataset:
  # Read-only sample dataset directory
  directory: "samples"
  readonly: true  # Never mutate original assets

  # Supported file formats
  supported_formats:
    - .jpg
    - .jpeg
    - .png
    - .heic
    - .webp

  # Incremental ingestion settings
  incremental: true  # Skip files that already have metadata cached
  state_file: "data/processing_state.json"

# Image preprocessing
preprocessing:
  # Normalize images
  target_format: "JPEG"  # Convert every asset to JPEG for downstream tasks
  max_dimension: 4096    # Maximum dimension in pixels

  # Thumbnail generation
  thumbnail:
    enabled: true
    size: [512, 512]     # Output thumbnail size (width, height)
    quality: 85          # JPEG quality (1-100)
    format: "JPEG"

  # Deduplication settings
  deduplication:
    enabled: true
    algorithm: "phash"   # Perceptual hash algorithm
    hash_size: 8        # Larger size increases precision
    threshold: 5        # Hamming distance threshold for duplicates

  # Storage layout (separate cache and persisted data)
  paths:
    # Reusable caches (safe across code versions)
    processed: "cache/images/processed"    # Normalized images
    thumbnails: "cache/images/thumbnails"  # Generated thumbnails
    embeddings: "cache/embeddings"         # Model embeddings for future phases
    detections: "cache/detections"         # Detection outputs
    ocr_results: "cache/ocr"              # OCR results cache
    hash_cache: "cache/hashes/phash_cache.json"  # Stores perceptual hash index

    # Version-specific data
    database: "data/vibe_photos.db"       # SQLite database file
    state: "data/processing_state.json"   # Processing progress

# Batch processing
batch_processing:
  batch_size: 10         # Number of images per worker batch
  max_workers: 8        # Maximum parallel workers
  checkpoint_interval: 50  # Persist state after this many images

# Detection engine configuration
detection:
  model: "google/siglip2-base-patch16-224"  # Multi-lingual SigLIP backbone
  confidence_threshold: 0.3  # Minimum confidence for accepted detections
  device: "auto"        # auto/cpu/cuda:0

  # Optional COCO class filters
  # filter_classes:
  #   - person
  #   - laptop
  #   - cell phone

# OCR configuration
ocr:
  enabled: true
  languages: ["ch", "en"]  # Supported languages
  use_angle_cls: true      # Detect text rotation

# Database configuration
database:
  type: "sqlite"
  path: "data/vibe_photos.db"

  # Search index settings
  search:
    engine: "fts5"        # SQLite full-text search engine
    tokenizer: "porter unicode61"  # Tokenizer configuration

# API service configuration
api:
  host: "127.0.0.1"
  port: 8000
  reload: true  # Enable auto-reload during development

# UI configuration
ui:
  framework: "streamlit"
  port: 8501

  # UI feature switches
  features:
    upload: false        # Disable uploads for the MVP
    batch_import: false  # Disable bulk import for the MVP
    search: true        # Enable semantic search
    browse: true        # Enable gallery browsing
    stats: true         # Enable statistics panel

# Temporary file handling
temporary:
  directory: "tmp"      # Scratch space for intermediate outputs
  cleanup: true         # Remove temporary files on exit

# Logging configuration
logging:
  level: "INFO"         # DEBUG/INFO/WARNING/ERROR
  format: "[%(asctime)s] %(levelname)s - %(message)s"
  directory: "log"      # Log directory
  file: "phase1.log"      # Log file name
  # Log rotation policy
  rotation:
    max_bytes: 10485760  # 10MB
    backup_count: 5      # Keep five backups

# Development overrides
development:
  debug: true
  test_mode: true       # Use the bundled sample dataset
  mock_detection: false  # Toggle mock detection responses
